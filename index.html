<html>

<head>
    <meta charset="utf-8">
    <title>FedLands</title>

    <link href="http://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
    <style>
        body {
            padding: 0;
            margin: 0;
            background: #8B4513;
            font-family: Montserrat, sans-serif;
        }
        
        #side-panel {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 500px;
            height: 900px;
            background: whitesmoke;
            border-right: 2px solid #8B4513;
            overflow-y: auto;
        }
        
        h1 {
            padding: 8px 25px 8px 15px;
            margin: 0;
            background: #8B4513;
            color: #fac985;
            font-weight: 400;
            font-size: 1.5em;
            text-align: right;
        }
        
        h2 {
            padding: 0px 25px 8px 15px;
            margin: 0;
            background: #8B4513;
            color: #fac985;
            font-weight: 300;
            font-size: 1.5em;
            text-align: right;
        }
        
        h3 {
            margin: 0;
            padding: 8px 25px 8px 15px;
            color: #8B4513;
            font-weight: 500;
            font-size: 1.2em;
            text-align: right;
        }
        
        ul li {
            margin: 0px;
            list-style-type: none;
            list-style-position: outside;
        }
        
        #side-panel p {
            margin: 8px 0 4px;
            padding: 0 25px 0 15px;
            color: #3d3d3d;
            text-align: right;
            font-size: 1em;
        }
        
        #side-panel p:after {
            content: '';
            display: block;
            clear: both;
        }
        
        #map {
            width: 900px;
            height: 900px;
            position: absolute;
            left: 500px;
            top: 0;
            border: 2px solid #2d1606;
            background: #FFEBCD;
            pointer-events: auto;
        }
        
        .land {
            fill: #F0F8FF;
            visibility: visible;
            pointer-events: auto;
        }
        
        .state {
            fill: none;
            stroke: #8B4513;
            stroke-width: 1.5px;
        }
        
        .state2 {
            fill: #d9d9d9;
            stroke: none;
        }
        
        .centroid {
            fill: #8B4513;
            visibility: visible;
            pointer-events: auto;
        }
        
        div.tooltip {
            position: absolute;
            left: 1410px;
            bottom: 400;
            width: 200px;
            color: #2d1606;
            background-color: #8B4513;
            padding: .5em;
            opacity: 1;
        }
        
        div.infoPanel {
            position: absolute;
            left: 1410px;
            bottom: 400;
            width: 200px;
            color: #2d1606;
            background-color: #8B4513;
            padding: .5em;
            opacity: 1;
        }
        
        .overlay {
            fill: none;
            pointer-events: auto;
        }
        
        .additional-column {
            position: absolute;
            left: 1410px;
            top: 8px;
            width: 300px;
            padding: .5em;
            color: #2d1606;
            background-color: #8B4513;
            max-height: 1000px;
        }
        
    </style>
    
</head>

<body>

    <div id="map"></div>
    <div id='side-panel'>
        <h1>Federally Owned Lands of the American West: </h1>
        <h2>Itâ€™s a lot</h2>
        <p>why a map</p>
        <h3>About the map</h3>
        <p>describe map features like the radio buttons/check boxes, hover</p>
        <h3>About the data</h3>
        <p>sources, breakdown of the other category</p>
    </div>
    
    <div class="additional-column">
        <form>
            <legend><strong>Select Layer(s):</strong></legend>
            <ul>
                <li>
                    <input class="checkbox-mp" name="checkbox-h-1" id="checkbox-h-1" type="checkbox">
                    <label for="checkbox-h-1"><span style='color: #fac985'>Bureau of Land Management</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-2" id="checkbox-h-2" type="checkbox">
                    <label for="checkbox-h-2"><span style='color: #fac985'>Department of Defense</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-3" id="checkbox-h-3" type="checkbox">
                    <label for="checkbox-h-3"><span style='color: #fac985'>Department of Energy</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-4" id="checkbox-h-4" type="checkbox">
                    <label for="checkbox-h-4"><span style='color: #fac985'>Forest Service</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-5" id="checkbox-h-5" type="checkbox">
                    <label for="checkbox-h-5"><span style='color: #fac985'>Fish and Wildlife Service</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-6" id="checkbox-h-6" type="checkbox">
                    <label for="checkbox-h-6"><span style='color: #fac985'>National Park Service</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-7" id="checkbox-h-7" type="checkbox">
                    <label for="checkbox-h-7"><span style='color: #fac985'>Other</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-8" id="checkbox-h-7" type="checkbox">
                    <label for="checkbox-h-8"><span style='color: #fac985'>Federally Owned (%)</span></label>
                </li>
            </ul>
        </form>
    </div>

    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/1.10.0/d3-legend.min.js"></script>

    <script>
        var width = 900,
            height = 900;
        
        var projection = d3.geo.conicConformal()
            .center([0, 40.5])
            .rotate([113, 0])
            .scale(2500)
            .translate([width / 2, height / 2]);
                
        var zoom = d3.behavior.zoom()
            .scaleExtent([1, 8])
            .on("zoom", zoomed);
        
        var geoPath = d3.geo.path()
            .projection(projection);

        var svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append('g');
        
        var g = svg.append('g');

	    svg.append('rect')
            .attr('class', 'overlay')
            .attr('width', width)
            .attr('height', height);

        var ordinal = d3.scale.ordinal()
            .domain(["State/Private Owned Lands", "BLM", "DOD", "DOE", "FS", "FWS", "NPS", "Other"])
            .range(["#d9d9d9", "#428DBD", "#0B3660", "#C6A6E8", "#00502F", "#F69E23", "#C56C39", "#FC4D38"]);

        var center = projection([12, 42]);

        var tooltip = d3.select('body').append('div')
            .attr('class', 'hidden tooltip');
        
        var infoPanel = d3.select('body').append('div')
            .attr('class', 'hidden tooltip');

        var legendOrdinal = d3.legend.color()
            .shape("path", d3.svg.symbol().type("square").size(150)())
            .shapePadding(10)
            .scale(ordinal);
        
        var formatAcre = d3.format(",");
        
        svg
            .call(zoom)
            .call(zoom.event);

        queue()
            .defer(d3.json, 'fedlands-topo.json')
            .defer(d3.json, 'eleven_states.json')
            .defer(d3.csv, 'elevenwest.csv')
            .await(makeMap);

        function makeMap(error, lands, states, centers) {
            console.log(lands);
//            console.log(states);
//            console.log(centers);
            
            var data = [];

            centers.forEach(function(place) {
                data.push(Number(place.percent));
            });

            var min = Math.min.apply(Math, data),
                max = Math.max.apply(Math, data);

            var radius = d3.scale.sqrt()
                .domain([min, max])
                .range([29, 84.9]);

            g.append("g")
                .selectAll("path")
                .data(states.features)
                .enter()
                .append("path")
                .attr("d", geoPath)
                .attr("class", "state2");

            g.append('g')
                .selectAll('path')
                .data(topojson.feature(lands, lands.objects.fedlands).features)
                .enter()
                .append('path')
                .attr("d", geoPath)
                .attr("fill", function(d) {
                    return ordinal(d.properties.ADMIN1)
                .on('mousemove', function(d, i) {
                    var currentPoint = this;
                    d3.select(this)
                    infoPanel.classed('hidden', 'false')
                        .html(
                            "<strong>Agency: </strong> <span style='color: #fac985'>" + d.properties.ADMIN1 + "</span> </br> <p> </p> <strong>Tract Name: </strong> <span style='color: #fac985'>" + d.properties.GNIS_NAME1 + "</span> </br> <p> </p> <strong>Description: </strong> <span style='color: #fac985'>" + d.properties.FEATURE1 +
                            "</li> </span> </ul>");
                })
                .on('mouseout', function(d, i) {
                    d3.select(this)
                    infoPanel.classed('hidden', 'true')
                        .html("")
                });
            })

            g.append("g")
                .selectAll("path")
                .data(states.features)
                .enter()
                .append("path")
                .attr("d", geoPath)
                .attr("class", "state");

            g.append("g")
                .selectAll("circle")
                .data(centers)
                .enter()
                .append("circle")
                .attr("cx", function(d) {
                    d.position = projection([d.lon, d.lat])
                    return d.position[0];
                })
                .attr("cy", function(d) {
                    return d.position[1];
                })
                .attr("r", function(d) {
                    return radius(d.percent)
                })
                .attr('class', 'centroid')
                .on('mousemove', function(d, i) {
                    var currentPoint = this;
                    d3.select(this)
                    .style({
                            'fill': '#F69E23',
                        })
                    tooltip.classed('hidden', 'false')
                        .html(
                            "<strong>State: </strong> <span style='color: #fac985'>" + d.long + "</span> </br> <p> </p> <strong>Federally Owned: </strong> <span style='color: #fac985'>" + d.percent + "%</span> </br> <p> </p> <strong>Total Acres: </strong> <span style='color: #fac985'>" + formatAcre(d.totalacre) +
                            "</span> </br> <p> </p> <strong>Acres by Agency:</br> <ul> <li>BLM: </strong> <span style='color: #fac985'>" + formatAcre(d.blm) +
                            "</li> </span> </br> <strong> <li>DOD: </strong> <span style='color: #fac985'>" + formatAcre(d.dod) +
                            "</li> </span> </br> <strong> <li>FS: </strong> <span style='color: #fac985'>" + formatAcre(d.fs) +
                            "</li> </span> </br> <strong> <li>FWS: </strong> <span style='color: #fac985'>" + formatAcre(d.fws) +
                            "</li> </span> </br><strong> <li>NPS: </strong> <span style='color: #fac985'>" + formatAcre(d.nps) +
                            "</li> </span> </ul>");
                })
                .on('mouseout', function(d, i) {
                    d3.select(this)
                        .style({
                            'fill': '#8B4513'
                        });
                    tooltip.classed('hidden', 'true')
                        .html("")
                });

            svg.append("g")
                .attr("class", "legendOrdinal")
                .attr("transform", "translate(20,20)");

            svg.select(".legendOrdinal")
                .call(legendOrdinal);            
        }
        
        function zoomed() {
            g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")")
        }
        
        d3.select(self.frameElement).style("height", height + "px");

    </script>
    
</body>

</html>
