<html>

<head>
    <meta charset="utf-8">
    <title>Western Federal Lands</title>

    <link href="http://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
    <style>
        body {
            padding: 0;
            margin: 0;
            background: #8B4513;
            font-family: Montserrat, sans-serif;
        }
        
        #side-panel {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 500px;
            height: 900px;
            background: #fde9ce;
            border-right: 2px solid #2d1606;
            border-bottom: 2px solid #2d1606;
            overflow-y: auto;
        }
        
        h1 {
            padding: 8px 25px 8px 15px;
            margin: 0;
            background: #8B4513;
            color: #fac985;
            font-weight: 400;
            font-size: 1.5em;
            text-align: right;
        }
        
        h2 {
            padding: 0px 25px 8px 15px;
            margin: 0;
            background: #8B4513;
            color: #fac985;
            font-weight: 300;
            font-size: 1.5em;
            text-align: right;
        }
        
        h3 {
            margin: 0;
            padding: 8px 25px 8px 15px;
            color: #8B4513;
            font-weight: 500;
            font-size: 1.2em;
            text-align: right;
        }
        
        #side-panel p {
            margin: 8px 0 4px;
            padding: 0 25px 0 15px;
            color: #3d3d3d;
            text-align: right;
            font-size: 1em;
        }
        
        #side-panel p:after {
            content: '';
            display: block;
            clear: both;
        }
        
        #map {
            width: 900px;
            height: 900px;
            position: absolute;
            left: 500px;
            top: 0;
            border: 2px solid #2d1606;
            background: #fac985;
            pointer-events: auto;
        }
        
        #legend {
            position: absolute;
            left: 150px;
            top: 550px;
            padding: 8px 15px;
            background: #fac985;
            border: 2px solid #8B4513;
            border-radius: 3px;
            color: #8B4513;
            width: 265px;
        }
        
        #legend h3 {
            text-align: center;
            font-weight: 500;
            margin: 0 0 10px;
        }
        
        #legend h4 {
            text-align: right;
            font-weight: 500;
            margin: 10px 0 5px;
        }
        
        #legend p {
            margin: 0 0 5px;
            text-align: right;
        }
        
        #legend span {
            display: block;
            border-radius: 50%/50%;
            float: right;
            height: 15px;
            width: 15px;
            text-align: right;
            font-size: 9px;
            color: #8B4513;
            margin-left: 10px;
        }
        
        #legend span.square {
            border-radius: 0;
        }
        
        #legend a {
            color: #8B4513;
        }
        
        .land {
            fill: #F0F8FF;
            pointer-events: auto;
        }
        
        .state {
            fill: none;
            stroke: #8B4513;
            stroke-width: 1.5px;
        }
        
        .state2 {
            fill: #fde9ce;
            stroke: none;
        }
        
        .centroid {
            fill: #8B4513;
            pointer-events: auto;
        }
        
        .centroidOff {
            fill: #fac985;
            pointer-events: auto;
        }
        
        div.infoPanel {
            position: absolute;
            left: 1410px;
            top: 400px;
            width: 200px;
            color: #2d1606;
            background-color: #8B4513;
            padding: .5em;
            opacity: 1;
        }
        
        div.infoPanel ul {
            list-style-type: none;
            padding: 0;
            margin: 4px 4px 0;
            color: #2d1606;
        }
        
        div.infoPanel li {
            list-style-type: none;
            height: 25px;
        }
        
        .overlay {
            fill: none;
            pointer-events: auto;
        }
        
        .layer-control {
            position: absolute;
            left: 1410px;
            top: 8px;
            width: 300px;
            padding: .5em;
            color: #2d1606;
            background-color: #8B4513;
            max-height: 500px;
        }
        
        a:link {
            text-decoration: none;
            color: #8B4513;
        }
        
        a:hover {
            color: red;
        }
        
        a:visited {
            color: #8B4513;
        }
        
        #tooltip-container {
            position: absolute;
            border-radius: 20px;
            color: #2d1606;
            background-color: #8B4513;
            padding: .5em;
            border: 1px solid #2d1606;
            display: none;
        }
        
        #tooltip-container ul {
            list-style-type: none;
            padding: 0;
            margin: 4px 4px 0;
            color: #2d1606;
        }
        
        #tooltip-container li {
            list-style-type: none;
            height: 25px;
        }
        
        #info-container {
            position: absolute;
            border-radius: 20px;
            color: #2d1606;
            background-color: #8B4513;
            padding: .5em;
            border: 1px solid #2d1606;
            display: none;
        }
        
        #info-container ul {
            list-style-type: none;
            padding: 0;
            margin: 4px 4px 0;
            color: #2d1606;
        }
        
        #info-container li {
            list-style-type: none;
            height: 25px;
        }

    </style>

</head>

<body>

    <div id="map"></div>
    <div id='side-panel'>
        <h1>The Many, Many (Many) Federally Owned Lands of the American West</h1>
        <p>This map depicts Federally Owned lands of the eleven western states. The topic has been mapped before, but this map is interactive (hover over lands to see which agency controls it), see the proportion of each states owned by the Federal government, and it is represented using an appropriate map projection.</p>
        <h3>About the map</h3>
        <p>Use the radio buttons to switch between the lands and the information circles. Use your mouse to scroll or double click to zoom and hold down the mouse to pan the map.</p>
        <h3>About the data</h3>
        <p><a href="http://nationalmap.gov/small_scale/atlasftp.html?openChapters=chpbound#chpbound">The National Map</a> from the <a href="https://opendata.go.ke/">The National Geological Survey</a> is the source for the land polygon data. The Federal Land Ownership: Overview and Data report from the Congressional Research Service was used for the information circle data; the 'Other Agencies' category is comprised of BOR, DOC, DOT, NASA, and USDA lands.</p>
    </div>
    <div id="legend">
        <h3>Legend</h3>
        <p class="percent"><span style='background:#8B4513;'></span>
            <label>Information Circles </label>
        </p>
        <h4>Land Tracts:</h4>
        <p class="zero"><span class="square" style='background:#d9d9d9;'></span>
            <label>State/Private Owned Lands </label>
        </p>
        <p class="one"><span class="square" style='background:#428DBD;'></span>
            <label>Bureau of Land Management </label>
        </p>
        <p class="two"><span class="square" style='background:#0B3660;'></span>
            <label>Department of Defense </label>
        </p>
        <p class="three"><span class="square" style='background:#C6A6E8;'></span>
            <label>Department of Energy </label>
        </p>
        <p class="four"><span class="square" style='background:#00502F;'></span>
            <label>US Forest Service </label>
        </p>
        <p class="five"><span class="square" style='background:#F69E23;'></span>
            <label>Fish and Wildlife Service </label>
        </p>
        <p class="six"><span class="square" style='background:#C56C39;'></span>
            <label>National Park Service </label>
        </p>
        <p class="seven"><span class="square" style='background:#FC4D38;'></span>
            <label>Other Agencies </label>
        </p>
    </div>
    <div id="tooltip"></div>
    <div id="tooltip-container"></div>
    <div id="info"></div>
    <div id="info-container"></div>
    <div class="layer-control">
        <form>
            <legend><strong>Select Layer(s):</strong></legend>
            <ul>
                <li>
                    <input class="checkbox-mp" name="checkbox-h-1" id="checkbox-h-1" type="checkbox">
                    <label for="checkbox-h-1"><span style='color: #fac985'>Bureau of Land Management</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-2" id="checkbox-h-2" type="checkbox">
                    <label for="checkbox-h-2"><span style='color: #fac985'>Department of Defense</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-3" id="checkbox-h-3" type="checkbox">
                    <label for="checkbox-h-3"><span style='color: #fac985'>Department of Energy</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-4" id="checkbox-h-4" type="checkbox">
                    <label for="checkbox-h-4"><span style='color: #fac985'>Forest Service</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-5" id="checkbox-h-5" type="checkbox">
                    <label for="checkbox-h-5"><span style='color: #fac985'>Fish and Wildlife Service</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-6" id="checkbox-h-6" type="checkbox">
                    <label for="checkbox-h-6"><span style='color: #fac985'>National Park Service</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-7" id="checkbox-h-7" type="checkbox">
                    <label for="checkbox-h-7"><span style='color: #fac985'>Other</span></label>
                </li>

                <li>
                    <input class="checkbox-mp" name="checkbox-h-8" id="checkbox-h-7" type="checkbox">
                    <label for="checkbox-h-8"><span style='color: #fac985'>Federally Owned (%)</span></label>
                </li>
            </ul>
        </form>
    </div>

    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <script>
        var width = 900,
            height = 900;

        var projection = d3.geo.conicConformal()
            .center([0, 40.5])
            .rotate([113, 0])
            .scale(3200)
            .translate([width / 2, height / 2]);

        var zoom = d3.behavior.zoom()
            .scaleExtent([1, 8])
            .on("zoom", zoomed);

        var geoPath = d3.geo.path()
            .projection(projection);

        var svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append('g');

        var g = svg.append('g');

        svg.append('rect')
            .attr('class', 'overlay')
            .attr('width', width)
            .attr('height', height);

        var ordinal = d3.scale.ordinal()
            .domain(["State/Private Owned Lands", "BLM", "DOD", "DOE", "FS", "FWS", "NPS", "Other"])
            .range(["#d9d9d9", "#428DBD", "#0B3660", "#C6A6E8", "#00502F", "#F69E23", "#C56C39", "#FC4D38"]);

        var center = projection([12, 42]);

        var formatAcre = d3.format(",");

        svg
            .call(zoom)
            .call(zoom.event);

        queue()
            .defer(d3.json, 'fedlands-topo.json')
            .defer(d3.json, 'eleven_states.json')
            .defer(d3.csv, 'elevenwest.csv')
            .await(makeMap);

        function makeMap(error, lands, states, centers) {
            //            console.log(lands);

            var data = [];

            centers.forEach(function(place) {
                data.push(Number(place.percent));
            });

            var min = Math.min.apply(Math, data),
                max = Math.max.apply(Math, data);

            var radius = d3.scale.sqrt()
                .domain([min, max])
                .range([29, 84.9]);

            g.append("g")
                .selectAll("path")
                .data(states.features)
                .enter()
                .append("path")
                .attr("d", geoPath)
                .attr("class", "state2");

            g.append('g')
                .selectAll('path')
                .data(topojson.feature(lands, lands.objects.fedlands).features)
                .enter()
                .append('path')
                .attr("d", geoPath)
                .attr("fill", function(d) {
                    return ordinal(d.properties.ADMIN1)
                })
                .on("mousemove", function(d) {
                    var html = "";
                    html +=
                        "<ul><ui><strong>Agency: </strong> <span style='color: #fac985'>" + d.properties.ADMIN1 + "</span> </br> <strong>Tract: </strong> <span style='color: #fac985'>" + d.properties.GNIS_Name1 + "</span> </br> <strong>Type: </strong> <span style='color: #fac985'>" + d.properties.FEATURE1 + "</li> </span> </ul>";

                    $("#tooltip-container").html(html);
                    $(this).attr("fill-opacity", "0.7");
                    $("#tooltip-container").show();

                    var coordinates = d3.mouse(this);

                    var map_width = $('g')[0].getBoundingClientRect().width;

                    if (d3.event.layerX < map_width / 100) {
                        d3.select("#tooltip-container")
                            .style("top", (d3.event.layerY + 15) + "px")
                            .style("left", (d3.event.layerX + 15) + "px");
                    } else {
                        var tooltip_width = $("#tooltip-container").width();
                        d3.select("#tooltip-container")
                            .style("top", (d3.event.layerY + 15) + "px")
                            .style("left", (d3.event.layerX - tooltip_width - 1) + "px");
                    }
                })
                .on("mouseout", function() {
                    $(this).attr("fill-opacity", "1.0");
                    $("#tooltip-container").hide();
                });

            g.append("g")
                .selectAll("path")
                .data(states.features)
                .enter()
                .append("path")
                .attr("d", geoPath)
                .attr("class", "state");

            g.append("g")
                .selectAll("circle")
                .data(centers)
                .enter()
                .append("circle")
                .attr("cx", function(d) {
                    d.position = projection([d.lon, d.lat])
                    return d.position[0];
                })
                .attr("cy", function(d) {
                    return d.position[1];
                })
                .attr("r", function(d) {
                    return radius(d.percent)
                })
                .attr('class', 'centroid')
                .on("mousemove", function(d, i) {
                    var html = "";
                    html +=
                        "<strong>State: </strong> <span style='color: #fac985'>" + d.long + "</span></br><strong>Federally Owned: </strong><span style='color: #fac985'>" + d.percent + "%</span> </br><strong>Total Acres: </strong><span style='color: #fac985'>" + formatAcre(d.totalacre) + "</span></br> <p> </p> <strong>Acres by Agency:</br> BLM: </strong> <span style='color: #fac985'>" + formatAcre(d.blm) +
                        "</span> </br> <strong> DOD: </strong> <span style='color: #fac985'>" + formatAcre(d.dod) + "</span> </br> <strong> FS: </strong> <span style='color: #fac985'>" + formatAcre(d.fs) + " </span> </br> <strong> FWS: </strong> <span style='color: #fac985'>" + formatAcre(d.fws) + " </span> </br><strong> NPS: </strong> <span style='color: #fac985'>" + formatAcre(d.nps) + " </span>";

                    $("#info-container").html(html);
                    $(this).attr('class', 'centroidOff');
                    $("#info-container").show();

                    var coordinates = d3.mouse(this);

                    var map_width = $('g')[0].getBoundingClientRect().width;

                    if (d3.event.layerX < map_width / 100) {
                        d3.select("#info-container")
                            .style("top", (d3.event.layerY + 5) + "px")
                            .style("left", (d3.event.layerX + 5) + "px");
                    } else {
                        var info_width = $("#info-container").width();
                        d3.select("#info-container")
                            .style("top", (d3.event.layerY + 5) + "px")
                            .style("left", (d3.event.layerX + info_width - 1) + "px");
                    }
                })
                .on("mouseout", function() {
                    $(this).attr('class', 'centroid');
                    $("#info-container").hide();
                });
        }

        function zoomed() {
            g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")")
        }

        d3.select(self.frameElement).style("height", height + "px");

    </script>

</body>

</html>
